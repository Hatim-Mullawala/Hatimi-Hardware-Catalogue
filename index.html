<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hatimi Hardware - Live Catalogue</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root { --primary-gold: #b38728; --dark-grey: #333; --light-grey: #f8f9fa; }
        
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 10px; background-color: #f0f2f5; }

        /* WEB VIEW STYLING - DO NOT CHANGE */
        .sticky-header {
            position: sticky; top: 0; z-index: 1000; background: white;
            padding: 10px 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex; justify-content: center; margin-bottom: 10px;
        }
        #searchInput { 
            width: 100%; max-width: 800px; padding: 12px 20px; font-size: 16px; 
            border: 2px solid var(--primary-gold); border-radius: 50px; outline: none; 
        }
        .container { max-width: 1200px; margin: auto; background: white; padding: 20px; box-shadow: 0 5px 25px rgba(0,0,0,0.1); border-radius: 12px; }
        .catalog-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 5px solid var(--primary-gold); padding-bottom: 15px; margin-bottom: 15px; width: 100%; background: white; box-sizing: border-box; }
        .logo-box { display: flex; align-items: center; gap: 10px; }
        .logo-box img { height: 60px; width: auto; object-fit: contain; }
        .shop-info h1 { margin: 0; color: var(--primary-gold); font-size: clamp(18px, 4vw, 28px); text-transform: uppercase; }
        .header-actions { display: flex; gap: 8px; }
        .action-btn { background: #f8f8f8; border: 1px solid #ddd; padding: 8px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; }
        .category-header { background: var(--dark-grey); color: white; padding: 12px 15px; font-size: 16px; margin-top: 30px; border-radius: 6px 6px 0 0; text-transform: uppercase; border-left: 8px solid var(--primary-gold); }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; border: 1px solid #ddd; padding: 15px; border-top: none; background: #fff; margin-bottom: 20px; border-radius: 0 0 8px 8px; }
        .product-card { border: 1px solid #eee; border-radius: 10px; padding: 12px; text-align: center; background: var(--light-grey); display: flex; flex-direction: column; min-height: 320px; box-sizing: border-box; overflow: hidden; }
        .image-box { width: 100%; height: 120px; background: white; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; border: 1px solid #eee; border-radius: 6px; overflow: hidden; }
        .image-box img { max-width: 90%; max-height: 90%; object-fit: contain; }
        .brand-tag { font-size: 9px; font-weight: 800; color: var(--primary-gold); text-transform: uppercase; margin-bottom: 4px; display: block; line-height: 1.1; }
        .product-name { font-size: 14px; font-weight: 700; color: #222; margin-bottom: 4px; line-height: 1.2; height: 34px; overflow: hidden; }
        .specs { font-size: 11px; color: #666; font-style: italic; line-height: 1.2; height: 26px; overflow: hidden; margin-bottom: 8px; }
        .price-contact-btn { background: white; color: var(--primary-gold); border: 1.5px solid var(--primary-gold); padding: 5px 8px; border-radius: 5px; text-decoration: none; font-size: 10px; font-weight: bold; transition: 0.3s; display: inline-block; margin-top: auto; }
        footer { margin-top: 40px; padding-top: 25px; border-top: 2px solid var(--primary-gold); text-align: center; width: 100%; }
        .contact-grid { display: flex; flex-wrap: wrap; justify-content: space-around; gap: 20px; margin-bottom: 25px; text-align: left; }
        .contact-item h4 { color: var(--primary-gold); margin: 0 0 10px 0; font-size: 16px; text-transform: uppercase; border-bottom: 1px solid #eee; }
        .contact-item p { margin: 8px 0; font-size: 14px; line-height: 1.5; color: #333; }
        .whatsapp-btn { display: inline-block; background: #25D366; color: white; padding: 10px 20px; border-radius: 20px; text-decoration: none; font-weight: bold; margin-top: 10px; font-size: 14px; }
        #update-stamp { font-size: 12px; color: #b38728; font-weight: bold; margin-bottom: 15px; display: block; }
        .print-table { border-collapse: collapse; width: 100%; table-layout: fixed; }
        .print-table td { width: 100%; }

        @media (max-width: 600px) {
            .product-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; }
            .product-card { padding: 8px; min-height: 280px; }
            .image-box { height: 100px; }
            .product-name { font-size: 12px; height: 30px; }
            .container { padding: 15px; }
        }

        /* --- THE AGGRESSIVE COMPACT PDF FIX --- */
        @media print {
            @page { size: A4; margin: 0.5cm; }
            .sticky-header, .header-actions, .whatsapp-btn, .price-contact-btn { display: none !important; }
            body { padding: 0; background: white; }
            .container { box-shadow: none; padding: 0; width: 100%; max-width: 100%; border-radius: 0; }

            .print-table { display: table !important; width: 100% !important; }
            .print-table thead { display: table-header-group !important; }
            
            .catalog-header { border-bottom: 2px solid var(--primary-gold); margin-bottom: 5px; width: 100% !important; display: flex !important; }
            .product-grid { 
                grid-template-columns: repeat(4, 1fr) !important; 
                gap: 5px !important; 
                border: none !important; 
                padding: 0 !important; 
                display: grid !important; 
                width: 100% !important; 
            }

            .product-card { 
                page-break-inside: avoid !important; 
                break-inside: avoid !important;
                border: 0.5px solid #ccc !important; 
                min-height: 1px !important; /* Forces removal of web min-height */
                height: 140px !important; /* THE SMALLEST POSSIBLE HEIGHT */
                margin-bottom: 5px; 
                padding: 4px !important;
                background: white !important;
            }

            .image-box { 
                height: 60px !important; /* Smaller images to save vertical space */
                border: none !important; 
                margin-bottom: 2px !important; 
                background: white !important;
            }
            .brand-tag { font-size: 7pt !important; margin: 0 !important; }
            .product-name { font-size: 9pt !important; height: auto !important; max-height: 25px !important; line-height: 1 !important; margin: 2px 0 !important; }
            .specs { font-size: 8pt !important; height: auto !important; max-height: 20px !important; line-height: 1 !important; margin: 0 !important; }
            
            .category-header { font-size: 11pt !important; margin-top: 5px !important; padding: 5px !important; -webkit-print-color-adjust: exact; }
            
            footer { border-top: 1px solid #ccc; padding-top: 5px; margin-top: 10px; }
            .contact-item p { font-size: 9pt !important; margin: 2px 0 !important; }
            .contact-item h4 { font-size: 10pt !important; margin-bottom: 2px !important; }
        }
    </style>
</head>
<body>

<div class="sticky-header">
    <input type="text" id="searchInput" placeholder="Search product or brand..." onkeyup="filterProducts()">
</div>

<div class="container">
    <table class="print-table">
        <thead>
            <tr>
                <td>
                    <header class="catalog-header" style="display: flex; justify-content: space-between; align-items: center; border-bottom: 5px solid var(--primary-gold); padding-bottom: 15px; margin-bottom: 15px; width: 100%; background: white; box-sizing: border-box;">
    <div class="logo-box" style="display: flex; align-items: center; gap: 12px;">
        <img src="logo.png" alt="Logo" onerror="this.src='https://via.placeholder.com/80x80?text=HATIMI'" style="height: 70px; width: auto; object-fit: contain;">
        <div class="shop-info">
            <h1 style="margin: 0; color: var(--primary-gold); font-size: clamp(22px, 5vw, 32px); text-transform: uppercase; line-height: 1.1;">Hatimi Hardware</h1>
            <p style="margin: 4px 0 0 0; font-weight: 800; color: #444; font-size: 16px; letter-spacing: 0.5px;">Quality Fittings ‚Ä¢ Trusted Tools</p>
        </div>
    </div>
    <div class="header-actions" style="display: flex; gap: 10px;">
        <button class="action-btn" onclick="window.print()" title="Download PDF" style="background: #f8f8f8; border: 1px solid #ddd; padding: 10px; border-radius: 50%; cursor: pointer; display: flex; align-items: center;">
            <svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="#b38728" d="M18,3H6V7H18M19,12A1,1 0 0,1 18,11A1,1 0 0,1 19,10A1,1 0 0,1 20,11A1,1 0 0,1 19,12M16,19H8V14H16M19,8H5A3,3 0 0,0 2,11V17H6V21H18V17H22V11A3,3 0 0,0 19,8Z" /></svg>
        </button>
        <button class="action-btn" onclick="location.reload()" title="Refresh Data" style="background: #f8f8f8; border: 1px solid #ddd; padding: 10px; border-radius: 50%; cursor: pointer; display: flex; align-items: center;">
            <svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="#b38728" d="M12,18A6,6 0 0,1 6,12C6,11 6.25,10.03 6.7,9.2L5.24,7.74C4.46,8.97 4,10.43 4,12A8,8 0 0,0 12,20V23L16,19L12,15V18M12,4V1L8,5L12,9V6A6,6 0 0,1 18,12C18,13 17.75,13.97 17.3,14.8L18.76,16.26C19.54,15.03 20,13.57 20,12A8,8 0 0,0 12,20V23L16,19L12,15V18Z" /></svg>
        </button>
    </div>
</header>
                </td>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    <div id="loader" style="text-align:center; padding:30px; font-weight:bold; color:var(--primary-gold);">üîÑ Syncing Inventory...</div>
                    <div id="main-content"></div>
                </td>
            </tr>
        </tbody>
    </table>

    <footer style="margin-top: 50px; padding: 40px 0; background: #ffffff; border-top: 4px solid var(--primary-gold); font-family: 'Segoe UI', sans-serif; width: 100%; box-sizing: border-box;">
        <div class="contact-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; width: 100%; margin: 0 auto; text-align: left;">
            
            <div class="contact-item">
                <h4 style="color: var(--primary-gold); margin: 0 0 15px 0; font-size: 18px; text-transform: uppercase; border-bottom: 2px solid #f0f0f0; padding-bottom: 5px;">üìç Visit Our Shop</h4>
                <p style="margin: 8px 0; font-size: 16px; line-height: 1.6; color: #333;">
                    <strong style="color: var(--dark-grey);">Hatimi Hardware</strong><br>
                    101, Subhash Path, Opp. Madhur Courier<br>
                    Barnagar, MP - 456771
                </p>
            </div>

            <div class="contact-item">
                <h4 style="color: var(--primary-gold); margin: 0 0 15px 0; font-size: 18px; text-transform: uppercase; border-bottom: 2px solid #f0f0f0; padding-bottom: 5px;">üìû Contact Details</h4>
                <p style="margin: 8px 0; font-size: 16px; color: #333;"><strong>Juzer:</strong> 94066 48766</p>
                <p style="margin: 8px 0; font-size: 16px; color: #333;"><strong>Shabbir:</strong> 94254 94845</p>
                <p style="margin: 8px 0; font-size: 16px; color: #333;"><strong>Murtaza:</strong> 81090 15951</p>
            </div>

            <div class="contact-item">
                <h4 style="color: var(--primary-gold); margin: 0 0 15px 0; font-size: 18px; text-transform: uppercase; border-bottom: 2px solid #f0f0f0; padding-bottom: 5px;">‚úâÔ∏è Support & Orders</h4>
                <p style="margin: 8px 0; font-size: 16px; color: #333;"><strong>Email:</strong> hussain22juzer@gmail.com</p>
                <div style="margin-top: 15px;">
                    <a href="https://wa.me/919406648766" class="whatsapp-btn" style="display: inline-block; background: #25D366; color: white; padding: 12px 25px; border-radius: 30px; text-decoration: none; font-weight: bold; font-size: 16px; box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3);">
                        Order on WhatsApp
                    </a>
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 40px; border-top: 1px solid #eee; padding-top: 20px;">
            <span id="update-stamp" style="font-size: 13px; color: var(--primary-gold); font-weight: bold; text-transform: uppercase; letter-spacing: 1px;">
                Syncing Inventory...
            </span>
            <p style="font-size: 12px; color: #888; margin-top: 10px;">¬© 2026 Hatimi Hardware. All Rights Reserved.</p>
        </div>
    </footer>
</div>

<script>
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRqfLPTM9QCajpUToFw0B2UTKUIv-0d3P5ldQxLWKYfD98PPVf5ZEDXITZuTrdNPh8D8dDKcJxO1D4O/pub?gid=0&single=true&output=csv';
    let allData = [];

    async function fetchData() {
        try {
            const response = await fetch(csvUrl);
            const csvText = await response.text();
            Papa.parse(csvText, {
                header: true, skipEmptyLines: true,
                complete: function(results) {
                    allData = results.data.filter(row => row['Product Name']);
                    render(allData);
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('update-stamp').innerText = "Last Sync: " + new Date().toLocaleString();
                }
            });
        } catch (e) { document.getElementById('loader').innerText = "Sync Error."; }
    }

    function render(data) {
        const target = document.getElementById('main-content');
        target.innerHTML = '';
        let matchedItems = new Set();

        // 1. Reordered Sections: Drilling is now higher to claim "Bits" first
        const groups = {
            "Drilling & Bits": ["Bit", "Drill", "Hole Saw", "Chuck", "Screwdriver Bit", "Hammer Bit"],
            "Cutting & Sawing": ["Aari", "Blade", "Cutter", "Kechi", "Snips", "Hacksaw", "Saw", "Scissor", "Trimmer"],
            "Striking & Fastening": ["Plier", "Pincer", "Wrench", "Pana", "Spanner", "Socket", "Hammer", "Goti", "L-Key", "Screw", "Driver", "Tester"],
            "Carpentry & Woodworking": ["Chorsi", "Radda", "Chisel", "Planer", "Router", "Measuring Tape", "Adze"],
            "Abrasives & Finishing": ["Carborundum", "Cumi", "Brush", "Wheel", "Disc", "File", "Silly", "Batti", "Sandpaper", "Grinding", "Buffing"]
        };

        // 2. Sorting Logic
        for (const [title, keys] of Object.entries(groups)) {
            const list = data.filter(row => {
                // Skip if this product was already matched in a previous section
                if (matchedItems.has(row)) return false;

                const keyword = (row['Image Keyword'] || '').toLowerCase().trim();
                const name = (row['Product Name'] || '').toLowerCase().trim();
                
                const isMatch = keys.some(k => {
                    const cleanKey = k.toLowerCase();
                    return keyword.includes(cleanKey) || name.includes(cleanKey);
                });

                if(isMatch) matchedItems.add(row);
                return isMatch;
            });
            if(list.length > 0) target.innerHTML += createGrid(title, list);
        }

        // 3. Fallback for Miscellaneous items
        const others = data.filter(row => !matchedItems.has(row));
        if(others.length > 0) {
             const uniqueKeywords = [...new Set(others.map(row => (row['Image Keyword'] || 'Miscellaneous')))];
             uniqueKeywords.forEach(k => {
                 const subList = others.filter(row => (row['Image Keyword'] || 'Miscellaneous') === k);
                 target.innerHTML += createGrid(k, subList);
             });
        }
    }
    function handleImageError(img, bImg, nImg, kImg) {
        let step = parseInt(img.getAttribute('data-step') || '1');
        
        // Console log helps you see exactly which file failed to load
        console.log("Failed: " + img.src + " | Trying Step: " + (step + 1));

        if (step === 1) { 
            img.setAttribute('data-step', '2'); 
            img.src = nImg; // Already includes 'tool/' from createGrid
        } 
        else if (step === 2) { 
            img.setAttribute('data-step', '3'); 
            img.src = kImg; // Already includes 'tool/' from createGrid
        } 
        else { 
            img.onerror = null; 
            img.src = 'https://via.placeholder.com/150?text=Photo+Required'; 
        }
    }

    function createGrid(title, list) {
        let gridHtml = `<div class="category-header">${title}</div><div class="product-grid">`;
        list.forEach(i => {
            const prodName = (i['Product Name'] || '').trim();
            const brandName = (i['Brand'] || '').trim();
            const imgKey = (i['Image Keyword'] || 'tool').trim();

            const clean = (t) => (t || '').toLowerCase().trim().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '');
            
            // Defining paths to look inside the 'tool' folder
            const bImg = `tool/${clean(brandName)}-${clean(prodName)}.jpg`;
            const nImg = `tool/${clean(prodName)}.jpg`;
            const kImg = `tool/${clean(imgKey)}.jpg`;
            
            const waMsg = encodeURIComponent(`Inquiry: ${brandName} ${prodName}\nRef: ${bImg}`);

            gridHtml += `<div class="product-card">
                <div class="image-box">
                    <img src="${bImg}" data-step="1" onerror="handleImageError(this, '${bImg}', '${nImg}', '${kImg}')">
                </div>
                <span class="brand-tag">${brandName}</span>
                <div class="product-name">${prodName}</div>
                <div class="specs">${i['Specifications'] || ''}</div>
                <a href="https://wa.me/919406648766?text=${waMsg}" class="price-contact-btn" target="_blank">REQUEST PRICE</a>
            </div>`;
        });
        return gridHtml + `</div>`;
    }

    function createGrid(title, list) {
        let gridHtml = `<div class="category-header">${title}</div><div class="product-grid">`;
        list.forEach(i => {
            const prodName = (i['Product Name'] || '').trim();
            const brandName = (i['Brand'] || '').trim();
            const imgKey = (i['Image Keyword'] || 'tool').trim();

            const clean = (t) => (t || '').toLowerCase().trim().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-').replace(/^-|-$/g, '');
            const bImg = `${clean(brandName)}-${clean(prodName)}.jpg`, nImg = `${clean(prodName)}.jpg`, kImg = `${clean(imgKey)}.jpg`;
            
            const waMsg = encodeURIComponent(`Inquiry: ${brandName} ${prodName}\nRef: ${bImg}`);

            gridHtml += `<div class="product-card">
                <div class="image-box">
                    <img src="${bImg}" data-step="1" onerror="handleImageError(this, '${bImg}', '${nImg}', '${kImg}')">
                </div>
                <span class="brand-tag">${brandName}</span>
                <div class="product-name">${prodName}</div>
                <div class="specs">${i['Specifications'] || ''}</div>
                <a href="https://wa.me/919406648766?text=${waMsg}" class="price-contact-btn" target="_blank">REQUEST PRICE</a>
            </div>`;
        });
        return gridHtml + `</div>`;
    }

    function filterProducts() {
        const query = document.getElementById('searchInput').value.toLowerCase();
        const filtered = allData.filter(item => (item['Product Name'] || '').toLowerCase().includes(query) || (item['Brand'] || '').toLowerCase().includes(query));
        render(filtered);
    }

    fetchData();
</script>
</body>
</html>